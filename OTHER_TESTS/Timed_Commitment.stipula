stipula Timed_Commitment {
  assets wallet
  fields secret, amount, deadline

  agreement(A,B){
    A,B:amount,deadline
  } => @Init

  @Init A: start(x)[h] (h >= amount){
           x -> secret
  h -o wallet
           now + deadline >> @Running { wallet -o B} => @Expired
  } => @Running

   @Running A: reveal()[]{
secret -> B
        wallet -o A
   } => @End
}